# ぱっと見ヘルスケア - 要件定義書

要件定義の作成原則
- **「あったらいいな」は絶対に作らない**
- **拡張可能性のための余分な要素は一切追加しない**
- **将来の「もしかして」のための準備は禁止**
- **今、ここで必要な最小限の要素のみ**

## 1. プロジェクト概要

### 1.1 成果目標
ユーザーが健康データを手軽に記録し、ダッシュボードで複数指標を直感的に一目で把握することで、生活習慣の改善につなげられるヘルスケアアプリを提供する。

### 1.2 成功指標

#### 定量的指標
- データ入力完了まで**30秒以内**
- ダッシュボードを開いた瞬間に**複数の健康指標が一画面で確認可能**
- ユーザーの**70%以上**が「改善すべき点に気づけた」と回答
- **月1回以上の継続利用率70%以上**（改善の習慣化）

#### 定性的指標
- 専門知識なしで体調の変化や傾向を視覚的に理解できる
- データを見て「何を改善すべきか」が明確になる
- 記録を続けることで生活習慣の改善意欲が湧く
- 過去データとの比較で改善の成果を実感できる

## 2. システム全体像

### 2.1 主要機能一覧
- **健康データ記録**: 体重・BMI、血圧、心拍数、体温、血糖値の手動入力
- **ダッシュボード表示**: 複数指標を色分け（緑/黄/赤）・グラフ・アイコンで直感的に表示
- **履歴・詳細分析**: 過去データを時系列グラフで確認、トレンド分析
- **データ管理**: PDF/CSVエクスポート、CSVインポート、データ削除

### 2.2 ユーザーロールと権限（MVP: 認証なし）
- **すべてのユーザー**: 全機能にアクセス可能（認証なし）
- データはブラウザのlocalStorageに保存され、個人のデバイス内で完結

### 2.3 認証・認可要件
- **MVP段階**: 認証機能なし
- **将来の拡張（Phase 2以降）**: メール＋パスワード認証、ソーシャルログイン追加予定

## 3. ページ詳細仕様

### 3.1 P-001: ダッシュボード（メインページ）

#### 目的
健康状態を一目で把握し、データを入力する。複数指標を色分け・グラフで直感的に表示し、改善点を即座に把握できる。

#### 主要機能
- 現在の健康指標概要（最新値を色分け表示：正常=緑、注意=黄、警告=赤）
- クイックデータ入力フォーム（全指標を1画面で入力可能）
- 直近7日間のミニグラフ（各指標の推移を一目で確認）
- 改善アドバイスメッセージ（注意・警告値の場合に表示）

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 取得 | 最新の健康データを取得 | なし（localStorage） | 各指標の最新値と色分け |
| 取得 | 直近7日間のデータを取得 | なし | 7日間の時系列データ |
| 作成 | 新しい健康データを記録 | 日時、体重、血圧、心拍数、体温、血糖値（任意） | 保存完了メッセージ、ダッシュボード更新 |

#### 処理フロー
1. ページ読み込み時、localStorageから最新データと直近7日間のデータを取得
2. 各指標を基準値と比較し、色分け判定（緑/黄/赤）
3. ミニグラフを生成して表示
4. ユーザーがクイック入力フォームにデータを入力
5. 「保存」ボタンクリックでlocalStorageに保存
6. ダッシュボードを自動更新、改善アドバイスを表示

#### データ構造（概念）
```yaml
HealthRecord:
  識別子: timestamp（記録日時）
  基本情報:
    - timestamp（必須）- 記録日時
    - weight（任意）- 体重（kg）
    - bloodPressureSystolic（任意）- 収縮期血圧（mmHg）
    - bloodPressureDiastolic（任意）- 拡張期血圧（mmHg）
    - heartRate（任意）- 心拍数（bpm）
    - temperature（任意）- 体温（°C）
    - bloodGlucose（任意）- 血糖値（mg/dL）
  メタ情報:
    - createdAt - 作成日時
    - updatedAt - 更新日時
  関連:
    - なし（単一エンティティ）
```

#### UI要素
- **ヘッダー**: アプリタイトル、ナビゲーション
- **健康指標カード（6枚）**:
  - 各指標の最新値、単位、色分け背景
  - アイコン（体重、血圧、心拍、体温、血糖）
  - ステータスラベル（「正常」「注意」「警告」）
- **ミニグラフセクション**: 直近7日間の折れ線グラフ
- **クイック入力フォーム**:
  - 日時選択（デフォルト: 現在）
  - 各指標の入力フィールド
  - 保存ボタン
- **改善アドバイス**: 注意・警告値がある場合のメッセージ表示エリア

---

### 3.2 P-002: 履歴・詳細分析

#### 目的
過去データを時系列で確認し、変化を把握する。過去との比較で生活習慣改善の成果を実感できる。

#### 主要機能
- 各健康指標の詳細グラフ（期間選択可能: 7日/30日/90日/全期間）
- データ一覧表示（テーブル形式）
- 個別データの編集・削除
- トレンド分析（上昇/下降傾向、平均値、最大値、最小値）

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 取得 | 指定期間のデータを取得 | 期間（7日/30日/90日/全期間） | 時系列データとグラフ |
| 取得 | トレンド統計を計算 | 指標名、期間 | 平均値、最大値、最小値、傾向 |
| 更新 | データを編集 | 記録ID、更新内容 | 更新完了メッセージ |
| 削除 | データを削除 | 記録ID | 削除完了メッセージ |

#### 処理フロー
1. ページ読み込み時、選択された期間のデータを取得
2. 指標別に詳細グラフを生成（MUI X Charts使用）
3. データ一覧をテーブル表示
4. トレンド統計を計算して表示
5. ユーザーが編集・削除ボタンをクリック
6. モーダルで編集フォーム表示 or 削除確認ダイアログ表示
7. 保存/削除実行、データ再取得して画面更新

#### UI要素
- **期間選択タブ**: 7日/30日/90日/全期間
- **指標選択**: 体重、血圧、心拍数、体温、血糖値（タブ or ドロップダウン）
- **詳細グラフ**:
  - 折れ線グラフ（色分け: 正常=緑、注意=黄、警告=赤）
  - 基準値ラインの表示
  - データポイントへのホバー表示
- **トレンド統計カード**:
  - 平均値
  - 最大値・最小値
  - 傾向（上昇↑/横ばい→/下降↓）
- **データテーブル**:
  - 日時、各指標の値
  - 編集・削除アクションボタン
- **編集モーダル**: 入力フォーム
- **削除確認ダイアログ**: 確認メッセージ

---

### 3.3 P-003: 設定・データ管理

#### 目的
データのバックアップと免責事項の確認。データの安全性と法的な透明性を確保。

#### 主要機能
- データエクスポート（PDF、CSV）
- データインポート（CSV）
- 全データ削除
- 免責事項表示
- アプリについて

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| エクスポート | PDF形式でデータ出力 | なし | PDFファイル（グラフ付きレポート） |
| エクスポート | CSV形式でデータ出力 | なし | CSVファイル（全データ） |
| インポート | CSV形式でデータ取り込み | CSVファイル | 取り込み完了メッセージ、データ件数 |
| 削除 | 全データを削除 | 確認チェック | 削除完了メッセージ |

#### 処理フロー
1. **PDFエクスポート**:
   - localStorageから全データ取得
   - @react-pdf/rendererでグラフ付きレポート生成
   - ダウンロード実行
2. **CSVエクスポート**:
   - localStorageから全データ取得
   - react-papaparseでCSV変換
   - ダウンロード実行
3. **CSVインポート**:
   - ファイル選択ダイアログ表示
   - CSVをパースしてバリデーション
   - 既存データとマージ or 上書き選択
   - localStorageに保存
4. **全データ削除**:
   - 確認ダイアログ表示
   - localStorageクリア実行
5. **免責事項表示**:
   - モーダルで全文表示

#### UI要素
- **データエクスポートセクション**:
  - PDFエクスポートボタン
  - CSVエクスポートボタン
- **データインポートセクション**:
  - CSVファイル選択ボタン
  - インポートオプション（マージ/上書き）
- **データ削除セクション**:
  - 全データ削除ボタン（危険アクション）
  - 確認チェックボックス
- **免責事項セクション**:
  - 免責事項表示ボタン
  - モーダル（全文表示）
- **アプリについてセクション**:
  - バージョン情報
  - 使い方ガイドへのリンク

---

## 4. データ設計概要

### 4.1 主要エンティティ

```yaml
HealthRecord:
  概要: 特定時点の健康データを記録するエンティティ
  主要属性:
    - 識別情報: timestamp（ISO 8601形式）
    - 体重関連: weight（kg）、bmi（自動計算）
    - 血圧関連: bloodPressureSystolic（mmHg）、bloodPressureDiastolic（mmHg）
    - その他バイタル: heartRate（bpm）、temperature（°C）、bloodGlucose（mg/dL）
    - メタ情報: createdAt、updatedAt
  関連:
    - なし（単一エンティティ、ユーザー認証なし）

UserSettings:
  概要: アプリの設定情報を保存するエンティティ
  主要属性:
    - 身長（BMI計算用）
    - 年齢（任意、将来の基準値調整用）
    - 性別（任意、将来の基準値調整用）
    - 初回起動フラグ（免責事項表示制御）
  関連:
    - なし
```

### 4.2 エンティティ関係図
```
UserSettings ──── 設定情報として独立保存

HealthRecord[] ──── 時系列の配列として保存
```

### 4.3 バリデーションルール
```yaml
体重（weight）:
  - ルール: 10〜300 kg、小数点第1位まで
  - 理由: 現実的な測定範囲

収縮期血圧（bloodPressureSystolic）:
  - ルール: 50〜250 mmHg、整数
  - 理由: 測定可能な範囲

拡張期血圧（bloodPressureDiastolic）:
  - ルール: 30〜150 mmHg、整数
  - 理由: 測定可能な範囲

心拍数（heartRate）:
  - ルール: 30〜200 bpm、整数
  - 理由: 測定可能な範囲

体温（temperature）:
  - ルール: 34.0〜42.0 °C、小数点第1位まで
  - 理由: 測定可能な範囲

血糖値（bloodGlucose）:
  - ルール: 30〜600 mg/dL、整数
  - 理由: 測定可能な範囲

日時（timestamp）:
  - ルール: 未来の日時は不可、ISO 8601形式
  - 理由: データの整合性確保
```

### 4.4 健康指標の判定基準

#### 体重・BMI（日本肥満学会基準）
- **正常**: BMI 18.5〜24.9
- **注意（低体重）**: BMI < 18.5
- **注意（肥満1度）**: BMI 25.0〜29.9
- **警告（肥満2度以上）**: BMI ≥ 30.0

#### 血圧（日本高血圧学会基準）
- **正常**: 収縮期 ≤ 129 mmHg かつ 拡張期 ≤ 84 mmHg
- **注意（I度高血圧）**: 収縮期 140-159 mmHg または 拡張期 90-99 mmHg
- **警告（II度高血圧以上）**: 収縮期 ≥ 160 mmHg または 拡張期 ≥ 100 mmHg

#### 心拍数
- **正常**: 60〜100 回/分（安静時）
- **注意（徐脈傾向）**: 50〜59 回/分
- **注意（頻脈傾向）**: 100〜119 回/分
- **警告（徐脈）**: < 50 回/分
- **警告（頻脈）**: ≥ 120 回/分

#### 体温（腋窩温）
- **正常（平熱）**: 36.5〜37.2°C
- **注意（微熱）**: 37.0〜37.4°C
- **警告（発熱）**: ≥ 37.5°C
- **警告（高熱）**: ≥ 38.0°C

#### 血糖値（空腹時）
- **正常**: 70〜109 mg/dL
- **注意（正常高値/境界型）**: 110〜125 mg/dL
- **警告（糖尿病型）**: ≥ 126 mg/dL

## 5. 制約事項

### 技術的制約
- **データ保存**: localStorageの容量制限（5〜10MB程度、ブラウザ依存）
- **ブラウザ依存**: データはブラウザごとに独立（ChromeとSafariで共有不可）
- **データ消失リスク**: ブラウザキャッシュクリアでデータ消失の可能性あり
- **デバイス間同期**: なし（CSV/PDFエクスポートで手動移行）

### 法的制約
- **医療機器該当性の回避**: 本アプリは医療機器ではなく、診断・治療目的ではない
- **免責事項の必須表示**: 初回起動時、設定画面で常に確認可能にする
- **自己判断の禁止**: 異常値の場合は必ず医療機関受診を促す

## 6. 複合API処理（バックエンド内部処理）

**MVP段階ではバックエンド不要のため、該当なし。**

## 7. 技術スタック

### フロントエンド（完全クライアントサイド）
- **フレームワーク**: React 18
- **言語**: TypeScript 5
- **UIライブラリ**: MUI v6
- **グラフライブラリ**: MUI X Charts
- **状態管理**: Zustand
- **ルーティング**: React Router v6
- **ビルドツール**: Vite 5
- **データ保存**: localStorage
- **PDFエクスポート**: @react-pdf/renderer + react-pdf-charts
- **CSVエクスポート**: react-papaparse

### バックエンド
- **なし**（完全クライアントサイド構成）

### データベース
- **なし**（localStorage使用）

### インフラ
- **ホスティング**: Vercel（静的サイトホスティング）

## 8. 必要な外部サービス・アカウント

### 必須サービス
| サービス名 | 用途 | 取得先 | 備考 |
|-----------|------|--------|------|
| Vercel | フロントエンドホスティング | https://vercel.com | 無料プラン利用 |

### オプションサービス
| サービス名 | 用途 | 取得先 | 備考 |
|-----------|------|--------|------|
| なし | - | - | 完全クライアントサイドのため不要 |

## 9. 今後の拡張予定（Phase 2以降）

### Phase 2: 顔画像解析機能
- **カメラで顔を撮影**し、以下を自動測定:
  - 顔色の測定
  - 目の大きさ・瞳の大きさの測定
  - 口角の上がり方の測定
- これらのデータから健康状態を推定
- **技術候補**: MediaPipe、TensorFlow.js、face-api.js

### Phase 3: ユーザー認証とマルチデバイス対応
- メール＋パスワード認証
- ソーシャルログイン（Google等）
- バックエンドAPI構築
- データベース移行（PostgreSQL等）
- デバイス間同期

### Phase 4: AI健康アドバイス
- 過去データのAI分析
- パーソナライズされた改善アドバイス

**注**: Phase 2以降は必要最小限の実装を維持し、MVP完成後に検討する

---

## 免責事項テンプレート

```
【免責事項】

本アプリケーションについて

1. 本アプリは医療機器ではありません
   本アプリは、入力されたデータに基づいて健康に関する情報を提供するものです。
   医療機器プログラムには該当せず、医学的助言、診断、治療、予防を目的とする
   ものではありません。

2. 医療従事者の代替ではありません
   本アプリは、医師その他の医療従事者による診断や治療の代わりとなるもの
   ではありません。健康上の懸念がある場合や、医療的な判断が必要な場合は、
   必ず医師または医療機関にご相談ください。

3. 自己判断の禁止
   本アプリが提供する情報のみに基づいて、医療上の意思決定や医薬品の服用
   開始・中止などの判断を行わないでください。

4. 緊急時の使用禁止
   生命に関わる緊急事態や、至急の医療が必要な状況では、本アプリを使用
   せず、直ちに119番に連絡するか、最寄りの医療機関を受診してください。

5. 情報の正確性
   本アプリで提供される情報は、一般的な医学的知見に基づくものですが、
   すべての個人に適用できるとは限りません。また、医学的知見は日々更新
   されるため、最新の情報については医療機関にご確認ください。

6. 責任の制限
   本アプリの利用により生じたいかなる損害についても、開発者および
   提供者は一切の責任を負いません。

7. データの取り扱い
   本アプリは健康情報を取り扱いますが、これらの情報は個人の健康管理を
   補助する目的でのみ使用され、医療行為には使用されません。
   データはお使いのブラウザ内に保存され、外部に送信されることはありません。
```

---

**作成日**: 2025-11-01
**バージョン**: 1.0.0
**最終更新日**: 2025-11-01
